<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Getting Dependabot and semantic-release to Play Nice | #!/matt/rathbun</title>
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hack-font@3/build/web/hack.css">

      <link rel="stylesheet" href="/css/colors.min.73a4fa8b5660037be8ad75523eebd8a911e1d976ef5865a3e6d301d6dce76d85.css" integrity="sha256-c6T6i1ZgA3vorXVSPuvYqRHh2XbvWGWj5tMB1tznbYU=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/main.min.3f68ed0ec8a35a8e6451d05944a3de0245be53651949cf19030f6db7f6d71788.css" integrity="sha256-P2jtDsijWo5kUdBZRKPeAkW&#43;U2UZSc8ZAw9tt/bXF4g=" crossorigin="anonymous">
      <link rel="stylesheet" href="/css/syntax.min.b840b9ed282a8d467cd5fb90af17571bda7b0cdcca46af05b6f2e9ac8b0377f9.css" integrity="sha256-uEC57SgqjUZ81fuQrxdXG9p7DNzKRq8FtvLprIsDd/k=" crossorigin="anonymous">


</head>
<body>
  <header>
    <div class="nav">
  <a href="/" class="accent">#!/matt/rathbun</a>
  <a href="/posts" class="left">/posts</a>

  <a href="https://github.com/mattbun" class="right">github</a>
</div>

  </header>
  <main>
    
  <h1>Getting Dependabot and semantic-release to Play Nice</h1>

  
  
  <time datetime="2021-06-19T00:00:00&#43;00:00">June 19, 2021</time>
  |
  
    <a class="tag" href="/tags/semantic-release/">#semantic-release</a>
    <a class="tag" href="/tags/dependabot/">#dependabot</a>


  <br>
  <br>
  <p>The other day, GitHub sent me a notification that there were a couple security vulnerabilities in the dependencies of one of my personal projects, <a href="https://github.com/mattbun/castaway">castaway</a>. Having used Dependabot at work, I figured I&rsquo;d enable it and get that vulnerability taken care of.</p>
<p>After I merged one of Dependabot&rsquo;s PRs, I was shocked (ðŸ˜±) to find that semantic-release hadn&rsquo;t made a release for it. Dependabot prefixed the commit with <code>build(deps):</code>, and semantic-release only creates releases for commits with prefixes <code>fix</code> and <code>feat</code>.</p>
<p>What&rsquo;s the point of a security update if it doesn&rsquo;t actually build a new image? Looks like I&rsquo;ve got some work to do.</p>
<h1 id="approach-1---change-dependabot-commit-messages">Approach #1 - Change Dependabot Commit Messages</h1>
<p>You can change Dependabot&rsquo;s commit messages! And not only that, you can change the commit prefix depending on whether its a dev or production dependency.</p>
<p>I configured dependabot to use the commit prefix <code>fix(deps)</code> for production dependencies with the following in <code>.github/dependabot.yml</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">updates</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">package-ecosystem</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;npm&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">interval</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;daily&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">commit-message</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">prefix</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;fix&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">prefix-development</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;build&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">include</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;scope&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">allow</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">dependency-type</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;production&#34;</span><span class="w">
</span></span></span></code></pre></div><p>This works! semantic-release bumps the patch version and triggers a new build when production dependencies are updated. Dev dependencies are still prefixed with <code>build</code>, which semantic-release ignores.</p>
<h2 id="but-theres-a-catch">But there&rsquo;s a catch!</h2>
<p>Dependabot comes in a couple different flavors:</p>
<ol>
<li>GitHub Dependabot - this is enabled by having a <code>.github/dependabot.yml</code> file in your repository</li>
<li>GitHub Dependabot Security Updates - this is enabled in your repository&rsquo;s &ldquo;Security &amp; Analysis&rdquo; section</li>
</ol>
<p>The dependabot configuration from above only affects the first one. Security updates <a href="https://github.community/t/how-to-get-dependabot-to-trigger-for-security-updates-only/117257/5">cannot be configured</a>. This also means that the configuration from above will enable <em>all</em> dependency updates, not just the ones with vulnerabilities.</p>
<p>Now this is probably fine for plenty of projects. Keeping dependencies up-to-date is noble. If you&rsquo;re fine with that, you&rsquo;re done! No need to read the next section.</p>
<p>But the project I&rsquo;m adding this to isn&rsquo;t worth all that hassle. I&rsquo;m fine with making some security updates here and there, but I don&rsquo;t want to spend all of my time updating dependencies unnecessarily.</p>
<p>I guess I have to give up the ability to configure Dependabot to get what I want ðŸ¤¦.</p>
<h1 id="approach-2---configure-semantic-release-to-understand-dependabot-commits">Approach #2 - Configure semantic-release to Understand Dependabot Commits</h1>
<p>We can&rsquo;t change how Dependabot Security Updates works, so we&rsquo;ll have to work with its default commit format: <code>build(deps)</code>.</p>
<h2 id="commit-analyzer-changes">commit-analyzer Changes</h2>
<p>First, we&rsquo;ll need to configure semantic-release to see dependabot commits as &ldquo;patch&rdquo;-worthy updates. That can be done by adding a <code>releaseRule</code> to the commit-analyzer configuration, like the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;release&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;@semantic-release/commit-analyzer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;preset&#34;</span><span class="p">:</span> <span class="s2">&#34;conventionalcommits&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;releaseRules&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;deps&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;release&#34;</span><span class="p">:</span> <span class="s2">&#34;patch&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Note that dev dependencies use a different scope, <code>deps-dev</code>, so those updates will continue to be ignored by semantic-release.</p>
<h2 id="release-notes-generator-changes">release-notes-generator Changes</h2>
<p>With just the commit-analyzer changes above, Dependabot updates will create releases, but the release notes in the GitHub release will be blank. That&rsquo;s not particularly helpful. To fix that, we&rsquo;ll need to make some configuration changes to semantic-release&rsquo;s release-notes-generator.</p>
<p>First off, you&rsquo;ll need to add <a href="https://www.npmjs.com/package/conventional-changelog-conventionalcommits">conventional-changelog-conventionalcommits</a> to your dev dependencies, if you don&rsquo;t already have it:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">yarn add -D conventional-changelog-conventionalcommits
</span></span></code></pre></div><p>Then configure the <code>release-notes-generator</code> plugin like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;release&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;@semantic-release/release-notes-generator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;preset&#34;</span><span class="p">:</span> <span class="s2">&#34;conventionalcommits&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;presetConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;types&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;feat&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;section&#34;</span><span class="p">:</span> <span class="s2">&#34;Features&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;fix&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;section&#34;</span><span class="p">:</span> <span class="s2">&#34;Bug Fixes&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;section&#34;</span><span class="p">:</span> <span class="s2">&#34;Dependencies and Other Build Updates&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nt">&#34;hidden&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>This puts any <code>build</code> commits in a new &ldquo;Dependencies and Other Build Updates&rdquo; section. That <code>&quot;hidden&quot;: false</code> is important! If you don&rsquo;t include it, it&rsquo;ll default to <code>true</code>.</p>
<p>Note that this change will put other <code>build</code> commits in your changelog as well, though they may not trigger a release on their own.</p>
<h3 id="do-i-have-to-use-the-conventionalcommits-preset">Do I have to use the conventionalcommits preset?</h3>
<p>I can&rsquo;t speak for the other presets, but <code>angular</code> doesn&rsquo;t support this as far as I can tell. The <code>conventionalcommits</code> preset has an <a href="https://github.com/conventional-changelog/conventional-changelog-config-spec/blob/master/versions/2.1.0/README.md">extensive configuration spec</a> while <a href="https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-angular#readme">the angular one doesn&rsquo;t seem to have any options?</a></p>
<h2 id="can-i-see-all-these-changes-in-one-place">Can I see all these changes in one place?</h2>
<p>Yep, <a href="https://github.com/mattbun/castaway/blob/bc4595ff2f52bf2f7d8b929f3c386f07472b2342/package.json#L36">see it in action here</a></p>

  </main>
  <footer>
    <p>Copyright 2025 Matt Rathbun. Made with <a href="https://gohugo.io/"> Hugo </a> and <a href="https://0x96f.dev/theme">0x96f</a>.</p>

  </footer>
</body>
</html>
